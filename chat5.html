<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>چت‌بات</title>
  <style>
    @font-face{
      font-family:'IRANYekanX';
      src:url('https://s34.picofile.com/file/8486538992/IRANYekanX_Light_woff2.html') format('woff2');
      font-weight:300;font-style:normal;font-display:swap;
    }
    :root{--bg:#0b1220;--card:#0f172a;--muted:#94a3b8;--ink:#e2e8f0;--accent:#6366f1;--radius:20px}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:'IRANYekanX',Tahoma,sans-serif}
    .wrap{max-width:920px;margin:28px auto;padding:0 16px}
    .card{background:var(--card);border-radius:22px;box-shadow:0 12px 34px rgba(0,0,0,.25);overflow:hidden;border:1px solid #1f2937}
    .head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #1f2937}
    .title{font-weight:700}
    .badge{font-size:12px;padding:3px 8px;border-radius:999px;background:#1f2937;color:#c7d2fe}
    .status{font-size:12px;color:#94a3b8}
    .msgs{height:62vh;overflow:auto;padding:18px;display:flex;flex-direction:column;gap:12px;background:#0b1220}
    .m{max-width:75%;padding:12px 14px;border-radius:14px;line-height:1.9;white-space:pre-wrap;word-wrap:break-word}
    .user{align-self:flex-end;background:#1d4ed8;color:#fff;border-bottom-right-radius:6px}
    .bot{align-self:flex-start;background:#111827;color:#e5e7eb;border:1px solid #1f2937;border-bottom-left-radius:6px}
    .foot{display:flex;gap:10px;padding:12px;border-top:1px solid #1f2937;background:#0f172a}
    .foot input{flex:1;padding:12px 14px;border:1px solid #334155;background:#0b1220;color:#e2e8f0;border-radius:12px;outline:none}
    .foot button{padding:12px 16px;border:0;border-radius:12px;background:var(--accent);color:#fff;cursor:pointer}
    .foot button[disabled]{opacity:.6;cursor:not-allowed}
    .spinner{width:16px;height:16px;border:3px solid #334155;border-top-color:#fff;border-radius:50%;animation:spin .9s linear infinite;display:inline-block;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
    .hint{font-size:12px;color:#94a3b8;margin:10px 14px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <div style="display:flex;align-items:center;gap:8px">
          <div class="title">چت‌بات</div>
          <span class="badge">Server (Cloudflare AI)</span>
        </div>
        <div id="status" class="status">آماده</div>
      </div>

      <div id="msgs" class="msgs"></div>

      <div class="foot">
        <input id="inp" placeholder="بنویس… (Enter = ارسال)" />
        <button id="sendBtn">ارسال</button>
      </div>
    </div>
    <div class="hint">
      پاسخ‌ها روی سرور Cloudflare Workers AI تولید می‌شود؛ نیازی به WebGPU کاربر نیست.
    </div>
  </div>

  <script>
    // آدرس Worker تو:
    const API_URL = "https://mioo-chat.mohamadgpt19.workers.dev/";

    const msgsEl = document.getElementById("msgs");
    const inp = document.getElementById("inp");
    const btn = document.getElementById("sendBtn");
    const statusEl = document.getElementById("status");

    const messages = [
      { role: "system", content: "تو یک دستیار فارسی‌بلد و کمک‌حالی. پاسخ‌ها را کوتاه و شفاف بده." }
    ];

    function addMsg(role, text){
      const div = document.createElement("div");
      div.className = "m " + (role==="user"?"user":"bot");
      div.textContent = text;
      msgsEl.appendChild(div);
      msgsEl.scrollTop = msgsEl.scrollHeight;
      return div;
    }
    function setBusy(b){ btn.disabled = b; statusEl.innerHTML = b ? '<span class="spinner"></span> در حال فکر کردن…' : 'آماده'; }

    async function send(){
      const text = inp.value.trim();
      if(!text) return;
      inp.value = "";
      addMsg("user", text);
      const b = addMsg("assistant", "…");
      setBusy(true);
      try{
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            system: messages[0].content,
            messages: [...messages, { role: "user", content: text }]
          })
        });
        const data = await res.json();
        if (!data.ok) throw new Error(data.error || "Server error");
        b.textContent = data.reply || "(بدون پاسخ)";
        messages.push({ role: "user", content: text });
        messages.push({ role: "assistant", content: String(data.reply || "") });
      }catch(err){
        b.textContent = "خطا: " + err.message;
        console.error(err);
      }finally{
        setBusy(false);
      }
    }

    btn.addEventListener("click", send);
    inp.addEventListener("keydown", (e)=>{ if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); send(); }});
    addMsg("assistant","سلام! من آماده‌ام 🙂 هر چه دوست داری بپرس.");
  </script>
</body>
</html>
