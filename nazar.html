<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ثبت نظر</title>
  <style>
    @font-face {
      font-family: 'IRANYekanX';
      src: url('./IRANYekanX-Light.woff2') format('woff2');
      font-weight: 300;
      font-style: normal;
      font-display: swap;
    }
    :root{--bg:#f7f7fb;--card:#fff;--ink:#111;--muted:#6b7280;--radius:16px}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:'IRANYekanX', Tahoma, Arial, sans-serif;color:var(--ink)}
    .wrap{max-width:760px;margin:40px auto;padding:0 16px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 6px 18px rgba(0,0,0,.08);padding:20px}
    h1{margin:0 0 12px;font-size:22px}
    p{margin:0 0 16px;color:var(--muted)}
    textarea{width:100%;min-height:140px;padding:12px;border:1px solid #e5e7eb;border-radius:12px;font:inherit;resize:vertical}
    button{margin-top:12px;padding:12px 16px;border:0;border-radius:12px;background:#111;color:#fff;font-weight:700;cursor:pointer}
    .state{margin-top:12px;font-size:14px}
    .ok{color:#059669}.err{color:#dc2626}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ارسال نظر</h1>
      <p>نظر یا پیام خود را وارد کنید و «ارسال» را بزنید.</p>
      <form id="f">
        <textarea id="msg" placeholder="متن پیام..."></textarea>
        <button type="submit">ارسال</button>
        <div id="state" class="state"></div>
      </form>
      <div class="note">با ارسال پیام، آی‌پی و اطلاعات دستگاه شما برای صفحهٔ مدیریت ذخیره می‌شود.</div>
    </div>
  </div>
  <script>
    const form = document.getElementById('f');
    const msgEl = document.getElementById('msg');
    const state = document.getElementById('state');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      state.textContent = 'در حال ارسال...'; state.className='state';
      const message = (msgEl.value||'').trim();
      if(!message){ state.textContent='لطفاً متن پیام را وارد کنید.'; state.classList.add('err'); return; }
      try{
        const r = await fetch('/api/submit', {
          method:'POST', headers:{'content-type':'application/json'},
          body: JSON.stringify({ message })
        });
        if(!r.ok) throw new Error('HTTP '+r.status);
        msgEl.value='';
        state.textContent='پیام شما با موفقیت ثبت شد!'; state.classList.add('ok');
      }catch(err){
        state.textContent='خطا در ارسال. لطفاً دوباره تلاش کنید.'; state.classList.add('err');
      }
    });
  </script>
</body>
</html>
